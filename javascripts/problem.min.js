function getCategory(t,e){$(".conver").show(),e||(e=1),$.ajax({url:domain+"/qa/0/questions?page="+e,type:"GET",success:function(e){if(1===e.code){t&&t(parseInt(e.data.total)),$(".conver").hide();var n=template("proView",e.data);$(".proContain").html(n)}else this.error()},error:function(){$(".conver").hide(),alertView("添加问题数据失败！",ERROR_COLOR)}})}function pagination(t){$(".M-box3").pagination({totalData:t||50,showData:10,jump:!0,coping:!0,homePage:"首页",endPage:"末页",prevContent:"上页",nextContent:"下页"});var e=0;$(".M-box3").delegate("a","click",function(){switch($(this).text()){case"下页":e+=10;break;case"上页":e-=10;break;case"末页":e=10*Math.floor(t/10);break;case"首页":e=0;break;case"跳转":e=10*($(".M-box3").find(".active").text()-1);break;default:e=10*($(this).text()-1)}getCategory("",e)})}function addQuestions(){$("#add-pic").on("click",function(){if("添加"===$(this).find("span").text())$(this).find("span").text("确认"),$(".proContain").append('<tr><td></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td></td><td></td></tr>>');else{if($(".proContain tr:last").children().eq(1).find("input").val()&&$(".proContain tr:last").children().eq(2).find("input").val()&&$(".proContain tr:last").children().eq(3).find("input").val()){var t={title:$.trim($(".proContain tr:last").children().eq(1).find("input").val()),content:$.trim($(".proContain tr:last").children().eq(3).find("input").val()),type:$.trim($(".proContain tr:last").children().eq(2).find("input").val())};$.ajax({url:domain+"/qa/"+t.type+"/questions",type:"POST",data:t,success:function(t){1===t.code?($(".conver").hide(),alertView("添加问题数据成功！",SUCCESS_COLOR),refView()):this.error()},error:function(t){$(".conver").hide(),alertView(t.msg,ERROR_COLOR)}})}$(this).find("span").text("添加"),$(".proContain tr:last").remove()}})}function alertView(t,e){$(".hostInfoRequestResView").text(t).css("backgroundColor",e).fadeIn(300),setTimeout(function(){$(".hostInfoRequestResView").text("").css("backgroundColor","none").fadeOut(500)},2e3)}function alterQuestions(){$(".proContain").delegate("a.edit-row","click",function(){var t="",e="",n="",i="";"编辑"===$(this).text()?($(this).text("确认"),t=$(this).parents().parents().children().eq(1).text(),e=$(this).parents().parents().children().eq(3).text(),$(this).parents().parents().children().eq(1).html('<input type="text">').find("input").val(t),$(this).parents().parents().children().eq(3).html('<input type="text">').find("input").val(e)):($(this).text("编辑"),t=$(this).parents().parents().children().eq(1).find("input").val(),e=$(this).parents().parents().children().eq(3).find("input").val(),n=$(this).parents().parents().children().eq(2).text(),i=$(this).parents().parents().children().eq(0).text(),console.log(n),console.log(i),t&&i?$.ajax({url:domain+"/qa/"+n+"/questions/"+i,type:"PUT",data:{title:t,content:e},success:function(n){1===n.code?($(".conver").hide(),$(this).parents().parents().children().eq(1).find("input").remove(),$(this).parents().parents().children().eq(3).find("input").remove(),$(this).parents().parents().children().eq(1).text(t),$(this).parents().parents().children().eq(3).text(e),alertView(n.msg,SUCCESS_COLOR),refView()):this.error()},error:function(t){$(".conver").hide(),alertView(t.msg,ERROR_COLOR)}}):alertView("请填写完整信息",ERROR_COLOR))})}function refView(){setTimeout(function(){location.href="/lianglixiaowu/problem.html"},1500)}var SUCCESS_COLOR="#38AF57",ERROR_COLOR="#D8534F";$(function(){getCategory(pagination),addQuestions(),alterQuestions()});