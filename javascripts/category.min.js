function getCategory(t,e){$(".conver").show(),e||(e=1),netWork(domain+"/qa/types?page="+e,"GET","",function(e){t&&t(parseInt(e.data.total)),$(".conver").hide();var n=template("categoryView",e.data);$(".proContain").html(n)})}function pagination(t){$(".M-box3").pagination({totalData:t||50,showData:10,jump:!0,coping:!0,homePage:"首页",endPage:"末页",prevContent:"上页",nextContent:"下页"});var e=0;$(".M-box3").delegate("a","click",function(){switch($(this).text()){case"下页":e+=10;break;case"上页":e-=10;break;case"末页":e=10*Math.floor(t/10);break;case"首页":e=0;break;case"跳转":e=10*($(".M-box3").find(".active").text()-1);break;default:e=10*($(this).text()-1)}getCategory("",e)})}function addQuestions(){$("#add-pic").on("click",function(){if("添加"===$(this).find("span").text())$(this).find("span").text("确认"),$(".proContain").append('<tr><td></td><td><input type="text"></td><td><input type="text"></td><td></td><td></td></tr>>');else{if($(".proContain tr:last").children().eq(1).find("input").val()&&$(".proContain tr:last").children().eq(2).find("input").val()){var t={name:$.trim($(".proContain tr:last").children().eq(1).find("input").val()),desc:$.trim($(".proContain tr:last").children().eq(2).find("input").val()),icon:"http://www.baidu.com/xx.jpg"};netWork(domain+"/qa/types","POST",t,function(){alertView("添加问题数据成功！",SUCCESS_COLOR),refView()})}$(this).find("span").text("添加"),$(".proContain tr:last").remove()}})}function alertView(t,e){$(".hostInfoRequestResView").text(t).css("backgroundColor",e).fadeIn(300),setTimeout(function(){$(".hostInfoRequestResView").text("").css("backgroundColor","none").fadeOut(500)},2e3)}function alterQuestions(){$(".proContain").delegate("a.edit-row","click",function(){var t="",e="",n="";if("编辑"===$(this).text())$(this).text("确认"),e=$(this).parents().parents().children().eq(1).text(),n=$(this).parents().parents().children().eq(2).text(),$(this).parents().parents().children().eq(1).html('<input type="text">').find("input").val(e),$(this).parents().parents().children().eq(2).html('<input type="text">').find("input").val(n);else{$(this).text("编辑"),t=$(this).parents().parents().children().eq(0).text(),e=$(this).parents().parents().children().eq(1).find("input").val(),n=$(this).parents().parents().children().eq(2).find("input").val();var i={id:t,name:e,desc:n,icon:"http://www.baidu.com/xx.jpg"};netWork(domain+"/qa/types/"+i.id,"PUT",i,function(){alertView("修改问题数据成功！",SUCCESS_COLOR),refView()}),$(this).parents().parents().children().eq(1).find("input").remove(),$(this).parents().parents().children().eq(2).find("input").remove(),$(this).parents().parents().children().eq(1).text(e),$(this).parents().parents().children().eq(2).text(n)}})}function dropQuestions(){$(".proContain").delegate("a.delete-row","click",function(){if(confirm("确认删除该条数据吗？")){var t=$(this).parents().parents().children().eq(0).find("input").val(),e={id:t};netWork(domain+"/qa/types/"+e.id,"DELETE",e,function(){alertView("删除问题数据成功！",SUCCESS_COLOR),refView()})}})}function netWork(t,e,n,i){$.ajax({url:t,type:e,data:n,success:function(t){1===t.code?($(".conver").hide(),i(t)):this.error(t)},error:function(t){$(".conver").hide(),alertView("失败！"+t.msg,ERROR_COLOR)}})}function refView(){setTimeout(function(){location.href="/lianglixiaowu/category.html"},1500)}var SUCCESS_COLOR="#38AF57",ERROR_COLOR="#D8534F";$(function(){getCategory(pagination),addQuestions(),alterQuestions(),dropQuestions()});